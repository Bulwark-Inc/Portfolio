{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<section class="max-w-7xl mx-auto px-4 py-12">
  <!-- Page Title -->
  <h1 class="text-3xl sm:text-4xl font-bold mb-8 text-center">Latest Blog Posts</h1>

  <!-- Search & Filter Form -->
  <form method="get" class="flex flex-wrap gap-4 items-center justify-center mb-10">
    <input type="text" name="q" value="{{ query|default:'' }}" placeholder="Search blogs..."
           class="w-full sm:w-64 px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">

    <select name="category"
            class="w-full sm:w-48 px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
      <option value="">All Categories</option>
      {% for cat in categories %}
        <option value="{{ cat }}" {% if cat == category %}selected{% endif %}>{{ cat }}</option>
      {% endfor %}
    </select>

    <button type="submit"
            class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition">
      Filter
    </button>
  </form>

  <!-- Blog Grid -->
  <div id="blog-grid" class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
    {% for blog in blogs %}
      {% include 'partials/blog_card.html' %}
    {% empty %}
      <p class="text-center col-span-full text-gray-500">No blogs found.</p>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if blogs.has_other_pages %}
    <div class="flex justify-center items-center space-x-2 mt-12">
      {% if blogs.has_previous %}
        <a href="?{% if query %}q={{ query }}&{% endif %}{% if category %}category={{ category }}&{% endif %}page={{ blogs.previous_page_number }}"
           class="px-4 py-2 border rounded hover:bg-gray-100">
          Previous
        </a>
      {% endif %}

      {% for num in blogs.paginator.page_range %}
        {% if blogs.number == num %}
          <span class="px-4 py-2 border rounded bg-blue-600 text-white">{{ num }}</span>
        {% elif num >= blogs.number|add:"-2" and num <= blogs.number|add:"2" %}
          <a href="?{% if query %}q={{ query }}&{% endif %}{% if category %}category={{ category }}&{% endif %}page={{ num }}"
             class="px-4 py-2 border rounded hover:bg-gray-100">{{ num }}</a>
        {% endif %}
      {% endfor %}

      {% if blogs.has_next %}
        <a href="?{% if query %}q={{ query }}&{% endif %}{% if category %}category={{ category }}&{% endif %}page={{ blogs.next_page_number }}"
           class="px-4 py-2 border rounded hover:bg-gray-100">
          Next
        </a>
      {% endif %}
    </div>
  {% endif %}
</section>
{% endblock %}
